<h1 style="text-align: center;"><strong><span style="font-family: 黑体, 'Heiti SC';">搭建多Master多Slave模式（同步）集群时的java.lang.NullPointerException异常</span></strong></h1>
<h2 style="text-align: left;"><span style="font-family: 黑体, 'Heiti SC'; font-size: 18pt;"><span style="font-size: 14pt;">一、运行环境等基本描述（问题产生原因是权限问题，即权限不够导致无法启动broker，甚至broker线程无法通过jps命令查出。下面阐述分析思路）</span></span></h2>
<p><span style="font-size: 18px;"><span style="font-family: 宋体, 'Songti SC';">1.1）</span><span style="font-family: 黑体, 'Heiti SC';"><span style="font-family: 宋体, 'Songti SC';">操作系统：<span style="font-family: 'times new roman', times;">Linux</span></span></span></span></p>
<p><span style="font-family: 黑体, 'Heiti SC'; font-size: 18px;"><span style="font-family: 宋体, 'Songti SC';">　　 虚拟机：<span style="font-family: 'times new roman', times;">VMware Workstation 16 Pro 、WSL</span><br /></span></span></p>
<p><span style="font-family: 黑体, 'Heiti SC'; font-size: 18px;"><span style="font-family: 宋体, 'Songti SC';">　&nbsp; <span style="font-family: 'times new roman', times;">Openjdk Version</span>：<span style="font-family: 'times new roman', times;">11.0.19<br /></span></span></span></p>
<p><span style="font-size: 18px;"><span style="font-family: 宋体, 'Songti SC';">　&nbsp; 使用<span style="font-family: 'times new roman', times;">RocketMQ</span>进行</span><span style="font-family: 宋体, 'Songti SC';">多<span style="font-family: 'times new roman', times;">Master</span>多<span style="font-family: 'times new roman', times;">Slave</span>模式（同步）集群的搭建</span></span></p>
<p><span style="font-size: 18px;"><span style="font-family: 宋体, 'Songti SC';">　2）集群配置：</span></span><span style="font-size: 18px;"><span style="font-family: 宋体, 'Songti SC';">　　　　</span></span></p>
<p>　　　　<span style="font-size: 18px; font-family: 'times new roman', times;"># nameserver</span><br /><span style="font-size: 18px; font-family: 'times new roman', times;">　　　xxx.xxx.xxx.xxx rocketmq-nameserver1</span><br /><span style="font-size: 18px; font-family: 'times new roman', times;">　　　xxx.xxx.xxx.xxx rocketmq-nameserver2</span></p>
<p><span style="font-size: 18px; font-family: 'times new roman', times;">　　　<span style="font-family: 'times new roman', times;">&nbsp;# broker</span></span></p>
<p><span style="font-family: 宋体, 'Songti SC';">　　　　<span style="font-size: 18px;"><span style="font-family: 'times new roman', times;">#&nbsp;</span>在<span style="font-family: 'times new roman', times;">VMware Workstation</span>上启动</span></span><br /><span style="font-size: 18px; font-family: 'times new roman', times;">　　　xxx.xxx.xxx.xxx:10911 rocketmq-master1<span style="font-family: 黑体, 'Heiti SC';">--&gt;</span> broker-a.properties</span><br /><span style="font-size: 18px; font-family: 'times new roman', times;">　　　xxx.xxx.xxx.xxx:11011 rocketmq-slave2&nbsp;<span style="font-family: 黑体, 'Heiti SC';">--&gt;</span> broker-b-s.properties</span></p>
<p><span style="font-size: 18px; font-family: 'times new roman', times;">　　　<span style="font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;">#</span> 在<span style="font-family: 'times new roman', times;">WSL</span>上启动</span></span></p>
<p><span style="font-size: 18px; font-family: 'times new roman', times;">　　　xxx.xxx.xxx.xxx:10911 rocketmq-master2&nbsp;<span style="font-family: 黑体, 'Heiti SC';">--&gt;</span> broker-b.properties</span><br /><span style="font-size: 18px; font-family: 'times new roman', times;">　　　xxx.xxx.xxx.xxx:11011 rocketmq-slave1&nbsp;<span style="font-family: 黑体, 'Heiti SC';">--&gt;</span> broker-a-s.properties</span></p>
<h2><span style="font-size: 14pt; font-family: 黑体, 'Heiti SC';">二、问题复现（在VMware Workstation上启动broker-a）</span></h2>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';">1.1）用户<span style="font-family: 'times new roman', times;">sumuwen</span>并不是<span style="font-family: 'times new roman', times;">root</span>用户，因此没有拥有至高权限</span></p>
<p>　　<img src="https://img2023.cnblogs.com/blog/3171133/202307/3171133-20230723212402105-1128207538.png" alt="" loading="lazy" /></p>
<p>　　&nbsp; &nbsp;&nbsp;<span style="font-family: 宋体, 'Songti SC'; font-size: 18px;">输入以上命令后，<span style="font-family: 'times new roman', times;">broker</span>启动过程中抛出异常</span><span style="font-family: 'times new roman', times; font-size: 18px;">java.lang.NullPointerException</span></p>
<p>　　<img src="https://img2023.cnblogs.com/blog/3171133/202307/3171133-20230723212716024-397576167.png" alt="" loading="lazy" /></p>
<h2><span style="font-family: 黑体, 'Heiti SC'; font-size: 14pt;">三、分析并解决问题</span></h2>
<p><span style="font-family: 宋体, 'Songti SC'; font-size: 18px;">1.1）检查线程<span style="font-family: 'times new roman', times;">ID</span>：使用<span style="font-family: 'times new roman', times;">jps</span>命令检查目前正在运行的线程<span style="font-family: 'times new roman', times;">ID</span>，发现<span style="font-family: 'times new roman', times;">broker</span>并未启动</span></p>
<p>　　<img src="https://img2023.cnblogs.com/blog/3171133/202307/3171133-20230723213351275-1532924645.png" alt="" loading="lazy" /></p>
<p><span style="font-family: 宋体, 'Songti SC'; font-size: 18px;">&nbsp;2）检查网络状态：使用<span style="font-family: 'times new roman', times;">netstat -tlnp<span style="font-family: 宋体, 'Songti SC';">命令检查网络状态，并未发现端口为<span style="font-family: 'times new roman', times;">10911</span>的进程出现在网络状态中，说明<span style="font-family: 'times new roman', times;">broker</span>并未被真正的启动。这一点也可以在<span style="font-family: 'times new roman', times;">broker.log<span style="font-family: 宋体, 'Songti SC';">或者在<span style="font-family: 'times new roman', times;">nohup</span>命令生成的<span style="font-family: 'times new roman', times;">nohup.out</span>文件中查询出来。其实，在这里linux就已经提示你了，因为不是root用户，所以目前用户的权限不足以查询出所有的信息。这一点其实也体现在了使用<span style="font-family: 'times new roman', times;">jps</span>命令时，可能你已经启动了<span style="font-family: 'times new roman', times;">broker</span>，但是<span style="font-family: 'times new roman', times;">jps</span>命令就是查询不出来。这也是我会进行检查线程<span style="font-family: 'times new roman', times;">ID</span>和检查网络状态这两个操作的原因，目的就在确定<span style="font-family: 'times new roman', times;">broker</span>是否已经启动。</span></span></span></span></span></p>
<p>　　<img src="https://img2023.cnblogs.com/blog/3171133/202307/3171133-20230723213704610-2096039532.png" alt="" loading="lazy" /></p>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';">　3）使用<span style="font-family: 'times new roman', times;">sudo</span>进行<span style="font-family: 'times new roman', times;">broker</span>的启动（每次启动一个<span style="font-family: 'times new roman', times;">broker</span>利用上面的方法检查<span style="font-family: 'times new roman', times;">broker</span>是否启动成功是一个非常有效率而且能够定位到启动的错误是什么的好习惯。当然，你也可以选择切换到<span style="font-family: 'times new roman', times;">root</span>用户使用<span style="font-family: 'times new roman', times;">jps</span>命令查询<span style="font-family: 'times new roman', times;">broker</span>是否启动成功）。在此之前，需要注意一件事情，第一次使用<span style="font-family: 'times new roman', times;">sudo</span>命令时需要输入密码，建议在输入密码后再使用<span style="font-family: 'times new roman', times;">sudo</span>命令启动<span style="font-family: 'times new roman', times;">broker</span>。</span></p>
<p>　　<img src="https://img2023.cnblogs.com/blog/3171133/202307/3171133-20230723220523109-2010291187.png" alt="" loading="lazy" /></p>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';">　注：<span style="font-family: 'times new roman', times;">nohup</span>命令会在执行后在你目前终端所处的文件位置生成一个<span style="font-family: 'times new roman', times;">nohup.out</span>文件，里面记录了一些关于你执行命令的状态信息。在启动<span style="font-family: 'times new roman', times;">broker<span style="font-family: 宋体, 'Songti SC';">的过程中除非你设置了环境变量，否则需要时刻注意你的终端中所处的文件位置，因为如果文件位置不对，你也无法在任何文件地点启动<span style="font-family: 'times new roman', times;">broker<span style="font-family: 宋体, 'Songti SC';">。启动<span style="font-family: 'times new roman', times;">broker</span>的文件位置一般是<span style="font-family: 'times new roman', times;">rocketmq</span>的<span style="font-family: 'times new roman', times;">bin</span>目录下。</span></span></span></span></span></p>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;"><span style="font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;"><span style="font-family: 宋体, 'Songti SC';">　4）切换到<span style="font-family: 'times new roman', times;">root</span>用户，我们发现<span style="font-family: 'times new roman', times;">broker-a</span>被成功启动。这里如果你不是<span style="font-family: 'times new roman', times;">root</span>用户使用<span style="font-family: 'times new roman', times;">jps<span style="font-family: 宋体, 'Songti SC';">的话，你是查询不出来<span style="font-family: 'times new roman', times;">broker</span>成功启动的进程<span style="font-family: 'times new roman', times;">ID</span>的。但是你可以使用（在使用非<span style="font-family: 'times new roman', times;">root</span>用户时）命令<span style="font-family: 'times new roman', times;">netstat -tlnp<span style="font-family: 宋体, 'Songti SC';">命令，可以发现端口号<span style="font-family: 'times new roman', times;">10911<span style="font-family: 宋体, 'Songti SC';">已被使用（只不过无法确定是否是<span style="font-family: 'times new roman', times;">broker-a</span>使用的，这时候去看<span style="font-family: 'times new roman', times;">broker.log</span>以及<span style="font-family: 'times new roman', times;">nohup.out</span>文件进行进一步的判断就十分重要了</span></span></span></span></span></span></span></span></span></span></span><span style="font-size: 18px; font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;"><span style="font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;"><span style="font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;"><span style="font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;"><span style="font-family: 宋体, 'Songti SC';"><span style="font-family: 'times new roman', times;"><span style="font-family: 宋体, 'Songti SC';">）</span></span></span></span></span></span></span></span></span></span></span></p>
<p>　　<img src="https://img2023.cnblogs.com/blog/3171133/202307/3171133-20230723220627069-449845733.png" alt="" loading="lazy" /></p>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';">2.1）使用<span style="font-family: 'times new roman', times;">WSL</span>的同志们会发现，不需要<span style="font-family: 'times new roman', times;">sudo</span>，不需要切换<span style="font-family: 'times new roman', times;">root</span>用户，直接使用<span style="font-family: 'times new roman', times;">broker</span>启动命令，然后用<span style="font-family: 'times new roman', times;">jps</span>命令进行线程<span style="font-family: 'times new roman', times;">ID</span>的查询，<span style="font-family: 'times new roman', times;">broker</span>就成功启动了！这是因为<span style="font-family: 'times new roman', times;">WSL</span>的用户，在一开始就是<span style="font-family: 'times new roman', times;">root</span>，即权限最高。因此，上述问题也就不复存在了。</span></p>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';">　2）上述仅仅是启动了集群中的<span style="font-family: 'times new roman', times;">broker-a</span>，在<span style="font-family: 'times new roman', times;">VMware Workstation</span>上还要启动<span style="font-family: 'times new roman', times;">broker-b-s</span>，步骤分析基本一样，就不过多赘述了。<br /></span></p>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';">　3）以上问题分析流程以及解决方式是启动<span style="font-family: 'times new roman', times;">broker</span>时出现</span><span style="font-family: 'times new roman', times; font-size: 18px;">java.lang.NullPointerException<span style="font-family: 宋体, 'Songti SC';">异常的一种解决思路的提供。</span></span></p>
<p><span style="font-family: 'times new roman', times; font-size: 18px;"><span style="font-family: 宋体, 'Songti SC';">　4）希望你能以最短的时间解决你的问题。&nbsp;<span style="font-family: 宋体, 'Songti SC';"><br /></span></span></span></p>
<p><span style="font-size: 18px; font-family: 宋体, 'Songti SC';">&nbsp;</span></p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<p>&nbsp;</p>
<h2 style="text-align: left;">&nbsp;</h2>