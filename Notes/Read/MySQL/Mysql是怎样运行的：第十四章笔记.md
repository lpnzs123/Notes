# Mysql是怎样运行的：第十四章笔记

---

## 前言

---

根据一定的规则，将执行起来十分耗费性能的语句重写成某种可以以比较高效率执行的形式，这个过程便是**查询重写。**

本章将围绕着查询重写中较为重要的一些**重写规则**展开论述。

<br />

## 条件化简

---

查询语句的搜索条件（本质上是表达式）的化简即**条件化简。**

化简的方式如下（a，b，c等字母均代表列名）：

* 移除不必要的括号。例如

  ```mysql
  -- 化简前
  ((a = 5 AND b = c) OR ((a > c) AND (c < 5)))
  
  -- 化简后
  (a = 5 and b = c) OR (a > c AND c < 5)
  ```

* 常量传递（Constant_Propagation）。即表达式是某个列 a 和某个常量做等值匹配，并且该表达式和其他涉及列 a 的表达式用关键字 AND 连接，那么就可以将其他涉及列 a 的表达式中 a 的值替换成做等值匹配的常量值。例如：

  ```mysql
  -- 化简前
  a = 5 AND b > a
  
  -- 化简后
  a = 5 AND b > 5
  ```

* 等值传递（Equality_Propagation）。例如：

  ```mysql
  -- 化简前
  a = b and b = c and c = 5
  
  -- 化简后
  a = 5 and b = 5 and c = 5
  ```

* 移除没用的条件（Trivial_Condition_Removal）。明显永远为 TRUE 或 FALSE 的表达式，优化器会移除他们。例如：

  ```mysql
  -- 化简前
  (a < 1 and b = b) OR (a = 6 OR 5 != 5)
  
  -- 化简后
  a < 1 OR a = 6
  ```

* 表达式计算。即查询执行之前，若表达式中只包含常量，则它的值会被先计算，例如：

  ```mysql
  -- 化简前（注意到表达式右边只包含常量）
  a = 5 + 1
  
  -- 化简后
  a = 6
  ```

  但是，如果列并不是以单独的形式作为表达式的操作数，那么优化器是不会尝试对这些表达式进行化简的。例如：

  ```mysql
  -- 列出现在函数中
  ABS(a) > 5
  
  -- 列出现在复杂的表达式中
  -a < -8
  ```

  我们知道，只有搜索条件中索引列和常数使用某些运算符连接起来才可能使用到索引，所以如果可以，**最好让索引列以单独的形式出现在表达式中。**

<br />















